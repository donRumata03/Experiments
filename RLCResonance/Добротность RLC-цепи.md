# Добротность RLC-цепи

> **Владимир Латыпов && Серёжа Онищенко**

## Формулировка задачи

Из данных элементов (резистор, конденсатор, катушка индуктивности) предлагается составить схему, подключив их последовательно соединённых к генератору синусоидальных колебаний напряжения, и, подключив щупы осциллографа  к резистору, снять резонансную кривую. Также нужно узнать у преподавателя номиналы используемых элементов (он измеряет их с помощью *профессиональных* / любительских (псевдо)инструментов).

Затем следует:

1. Посчитать теоретическое значение добротности контура, зная все номиналы
2. Доказать, что существует эквивалентное определение добротности через график
3. Посчитать добротность из графика
4. Сравнить, сделать выводы

## Методика

***Всё также*** рассмотрим резонансную кривую, для этого промерим непустое множество точек в районе «ROI» — Region Of Interest, в именно — вокруг пика.

Подключим щупы осциллографа к резистору, собрав всё ту же схему:

![image-20210212233442831](D:\Projects\Experiments\RLCResonance\scheme.png)

Затем, крутя ручку генератора и записывая его частоту, будем также замечать амплитуду, которую показывает осциллограф. Был ещё вариант записывать всё на видео, но мы посчитали его нецелесообразным, например, потому что он мешает оценивать нашу работу в реальном времени и, соответственно, не даёт достаточной обратной связи.

## Теоретическое обоснование

Напряжение на катушке и на конденсаторе противоположны по фазе, то есть сумма векторов — просто разность модулей. Проекции этой суммы, напряжения на резисторе и на источнике должны давать ноль, следовательно, 
$$
U_0^2=U_{0R}^2+(U_{0L}-U_{0C})^2\\
U_0^2=(RI)^2+(L\frac{d^2q}{dt^2}-\frac{q}{C})^2
$$
Так как
$$
I_0 cos(wt)=\frac{dq}{dt}=\frac{d(CU_c)}{dt}=C\frac{dU_c}{dt}\\
\frac{dU_c}{dt} = \frac{1}{C}I_0 cos(wt)\\
U_C = \frac{1}{wC}I_0 sin(wt)\\
U_{0C}=\frac{1}{wC}
$$
Аналогично для катушки
$$
L\frac{d^2q}{dt^2}=U_{L}\\
L\frac{d(I_0·cos(wt))}{dt}=U_L\\
U_L = LwI_0·sin(wt)\\
U_{0L} = Lw·I_0
$$
Тогда 
$$
\label{current_formula}
U_0^2 = I^2R^2+\left(\frac{1}{wC}-wL\right)^2I^2\\
I_0 =\frac{ε}{\sqrt{R^2+\left(\frac{1}{wC}-wL\right)^2}}
$$

### Добротность

Как известно, из теории добротность выражается так:
$$
Q = \frac{1}{R} \sqrt{\frac{L}{c}}
$$
Докажем, что есть эквивалентное определение:

> Если на резонансной кривой найти две точки, значения амплитуды тока в которых = $\frac{I_{max}}{\sqrt{2}}$, то значение добротности контура будет $Q = \frac{\omega_0}{\Delta\omega}$, где $\Delta\omega$ — разность частот в этих двух точках.

Напомним, что 
$$
I_0 = \frac{ε}{\sqrt{R^2+\left(\frac{1}{wC}-wL\right)^2}}
$$
Тогда
$$
I_{max} = \frac{\varepsilon}{R}
$$
Если
$$
\frac{ε}{\sqrt{R^2+\left(\frac{1}{wC}-wL\right)^2}} = \frac{\varepsilon}{\sqrt{2} \cdot R}
$$
То
$$
\sqrt{R^2+\left(\frac{1}{wC}-wL\right)^2} = \sqrt{2} \cdot R
$$

$$
R^2+\left(\frac{1}{wC}-wL\right)^2 = 2 \cdot R^2
$$

$$
\frac{1}{\omega C}-\omega L = \pm \sqrt{R^2} = \pm R
$$


$$
\frac{L}{\omega} \left( \omega_0^2 - \omega^2 \right) = \pm R \approx \frac{L}{\omega_0} \left( \omega_0^2 - \omega^2 \right)
$$

$$
\pm R \cdot \frac{\omega_0}{L} \approx \left( \omega_0 - \omega \right) \cdot \left( \omega_0 + \omega \right) \approx 2 \omega_0 \left( \frac{\Delta\omega}{2} \right)
~~~~~~~~~~~~~~~ \left(\frac{\Delta\omega}{2}~—~ потому\ что\ \Delta\omega\ —\ это\ вся\ ширина\ «ворот»\right)
$$

(то же самое можно получить, если выразить сдвиг как дифференциал ($\frac{dx}{dy} = \frac{\Delta x}{f(x + \Delta x) - f(x)} = \frac{1}{f'}$, $(x^2)' = 2x$))
$$
\Delta\omega \approx \frac{R}{L}
$$

$$
Q = \frac{\omega_0}{\Delta\omega} = \frac{\omega_0}{\frac{R}{L}} = \frac{\omega_0 L}{R}
$$

Вспомнив, что
$$
\omega_0 = \frac{1}{\sqrt{LC}}
$$
Получим, что
$$
Q = \frac{\omega_0 L}{R} = \frac{L}{R\sqrt{LC}} = \frac{1}{R}\sqrt{\frac{L}{C}}~~\blacksquare∎\blacksquare
$$

## Ближе к реальности

### Измерения

Вспомним, что в прошлый раз мы уже проводили измерения, получив аппроксимированный график резонансной:

![image-20210212230910310](D:\Projects\Experiments\RLCResonance\images\approx.png)

### Обработка данных

Напишем программу для автоматического поиска добротности цепи по заданной резонансной кривой в виде вызываемой функции.

Будем использовать n-арный поиск для нахождения необходимых значений частоты путём оптимизации разных функций:

```python
def n_ary_search(function: Callable, depth_left: int, left: float, right: float, n_arity: int, ns : int, max_or_min: bool = True) -> float:
   if depth_left == 0:
      return (left + right) / 2

   step = (right - left) / n_arity
   offset = step * ns

   optimal_x = None
   optimal_value = None
    
   for step_index in range(n_arity + 1):
      this_x = left + step * step_index
      this_value = function(this_x)
    
      if optimal_x is None or (this_value > optimal_value if max_or_min else this_value < optimal_value):
         optimal_x = this_x
         optimal_value = this_value

   return n_ary_search(
       function, 
       depth_left - 1,
       max(left, optimal_x - offset),
       min(right, optimal_x + offset),
       n_arity, ns)
```

Для начала просто найдём её максимум. Для этого достаточно взять результат максимизации самой функции (аргумент максимума).

Далее по значению максимума найдём $\frac{I_{max}}{\sqrt{2}}$ и для определения частот с амплитудой $\frac{I_{max}}{\sqrt{2}}$ определим целевую функцию
$$
error(\omega) = -\left(resonance\_curve(\omega) - \frac{I_{max}}{\sqrt{2}} \right)^2
$$
, при оптимизации которой на промежутках $(0, \omega_0]$ и $[\omega_0; + \infty)$ получим $\omega_{left}$ и $\omega_{right}$ соответственно.

Вот так выглядит эта функция:

![image-20210219171634932](images\error_function.png)

А вот визуализация процесса поиска необходимой точки:

![demonstration](images\demonstration.png)

## Результаты

Торжественное обвъявление результатов:

Результат, полученный аналитически через измерения параметров элементов: 
$$
Q_{anal} = \frac{1}{R}\sqrt{\frac{L}{C}} \approx \frac{1}{1537 \Omega} \cdot \sqrt{\frac{1.2987 ~ Henyy}{1.34 \times 10^{-8} Farad}}
 \approx 6.40 ~ pcs.
$$


Результат, посчитанный с помощью резонансной кривой:
$$
Q_{graph} = \frac{\omega_0}{\Delta\omega} \approx \frac{1234.5593705982699}{1328.6944466840528 - 1147.093559618874 } = 6.79 ~ pcs.
$$
Числа специально даны столь «неокруглённо», чтобы было в духе настоящей работы программы:

<img src="D:\Projects\Experiments\RLCResonance\images\program_output.png" alt="image-20210219183108200" style="zoom: 33%;" />

То есть отклонение:
$$
\Delta Q = \frac{\left|Q_{anal} - Q_{graph}\right|}{Q_{anal} + Q_{graph}} \approx 0.02977 \approx 0.03 = 3\%,\ which\ is\ pretty\ cool.
$$

## Вывод

Результаты, полученные разными методами, оказались очень даже близкими (3% — это вам не ***хухры-мухры***!). Более того, учитывая такое небольшие расхождение, ещё не факт, что оно в основном вызвано неточностью при аппроксимации резонансной кривой, а не погрешностью прибора для измерения характеристик элементов. Как минимум понятно, что если увеличить количество точек, а в идеале — вообще автоматизировать процесс получения точек, можно добиться  гораздо большей точности, чем при напрашивающемся методе с измерением характеристик каждого элемента по отдельности.